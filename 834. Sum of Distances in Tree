import sys
sys.setrecursionlimit(10**7)

class Solution(object):
    def sumOfDistancesInTree(self, n, edges):
        """
        :type n: int
        :type edges: List[List[int]]
        :rtype: List[int]
        """
        if n == 1:
            return [0]

        # Build adjacency list
        graph = [[] for _ in range(n)]
        for a, b in edges:
            graph[a].append(b)
            graph[b].append(a)

        res = [0] * n         # res[i] = sum of distances from i to all nodes
        subtree_size = [1] * n  # subtree_size[i] = number of nodes in subtree rooted at i

        # First DFS: compute subtree sizes and res[0] (sum of distances from root 0)
        def dfs1(node, parent):
            for nei in graph[node]:
                if nei == parent:
                    continue
                dfs1(nei, node)
                subtree_size[node] += subtree_size[nei]
                res[node] += res[nei] + subtree_size[nei]

        # Second DFS: reroot DP to get res for all nodes
        def dfs2(node, parent):
            for nei in graph[node]:
                if nei == parent:
                    continue
                # Move root from node to nei
                res[nei] = res[node] - subtree_size[nei] + (n - subtree_size[nei])
                dfs2(nei, node)

        dfs1(0, -1)
        dfs2(0, -1)
        return res
